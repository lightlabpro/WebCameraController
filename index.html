<!doctype html>
<html>
<head>
    <title>Live Motion Controller</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .data { background: #198754; padding: 20px; border-radius: 8px; margin: 20px 0; font-size: 18px; }
        .raw { background: #6c757d; padding: 15px; border-radius: 8px; margin: 15px 0; font-family: monospace; }
        .status { background: #0d6efd; padding: 15px; border-radius: 8px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>ðŸ“± Live Motion Controller</h1>
    
    <div class="status">
        <strong>Status:</strong> <span id="status">Initializing...</span>
    </div>
    
    <div class="data">
        <strong>Orientation: [0.0000, 0.0000, 0.0000, 1.0000]</strong>
    </div>
    
    <div class="raw">
        <strong>Raw Motion Data:</strong><br>
        Alpha: <span id="alpha">0</span>Â°<br>
        Beta: <span id="beta">0</span>Â°<br>
        Gamma: <span id="gamma">0</span>Â°
    </div>
    
    <p>Move your phone to see live orientation data!</p>
    
    <script>
        let isReceivingData = false;
        let lastUpdateTime = Date.now();
        
        // Update status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        // Update orientation display
        function updateOrientationDisplay(x, y, z, w) {
            document.querySelector('.data').innerHTML = 
                `<strong>Orientation: [${x.toFixed(4)}, ${y.toFixed(4)}, ${z.toFixed(4)}, ${w.toFixed(4)}]</strong>`;
        }
        
        // Update raw values
        function updateRawValues(alpha, beta, gamma) {
            document.getElementById('alpha').textContent = alpha.toFixed(1);
            document.getElementById('beta').textContent = beta.toFixed(1);
            document.getElementById('gamma').textContent = gamma.toFixed(1);
        }
        
        // Check if device orientation is available
        if (window.DeviceOrientationEvent) {
            updateStatus("Device orientation available - waiting for data...");
            
            window.addEventListener('deviceorientation', (e) => {
                if (e.alpha !== null && e.beta !== null && e.gamma !== null) {
                    // Update raw values
                    updateRawValues(e.alpha, e.beta, e.gamma);
                    
                    // Convert to quaternion format (simplified)
                    let x = (e.alpha / 180) * 0.5;
                    let y = (e.beta / 180) * 0.5;
                    let z = (e.gamma / 180) * 0.5;
                    let w = 1.0;
                    
                    // Update the orientation display
                    updateOrientationDisplay(x, y, z, w);
                    
                    // Update status
                    isReceivingData = true;
                    lastUpdateTime = Date.now();
                    updateStatus(`Receiving motion data - Last update: ${new Date().toLocaleTimeString()}`);
                    
                    console.log("Motion update:", x, y, z, w);
                } else {
                    console.log("Orientation values are null:", e);
                    updateStatus("Orientation values are null - check permissions");
                }
            });
            
            // Check if we're still receiving data
            setInterval(() => {
                if (isReceivingData && (Date.now() - lastUpdateTime) > 5000) {
                    updateStatus("No recent motion data - move your phone");
                    isReceivingData = false;
                }
            }, 1000);
            
        } else {
            updateStatus("Device orientation not available - try a different browser");
            document.querySelector('.data').innerHTML = 
                '<strong style="color: red;">Device orientation not available</strong>';
        }
        
        // Force update every 100ms to ensure Unity gets fresh data
        setInterval(() => {
            if (isReceivingData) {
                // This ensures the data is always fresh for Unity to read
                console.log("Broadcasting current orientation data");
            }
        }, 100);
    </script>
</body>
</html>
